# 批量视频下载功能使用指南

## 功能概述

批量视频下载功能是原有批量视频信息获取功能的增强版本，支持在获取视频详细信息的同时下载视频文件。

## 主要特性

- ✅ **视频信息获取**：获取完整的视频元数据信息
- ✅ **视频文件下载**：支持批量下载视频文件
- ✅ **智能跳过**：自动跳过已下载的视频文件
- ✅ **下载统计**：提供详细的下载成功/失败统计
- ✅ **时长过滤**：支持CapCut检测的时长过滤模式
- ✅ **断点续传**：支持中断后重新运行，跳过已下载文件

## 使用方法

### 基本命令格式

```bash
node examples/batch-video-details-with-download.js <CSV文件路径> [--download]
```

### 参数说明

- `<CSV文件路径>`：包含视频ID的CSV文件路径（必需）
- `--download`：启用视频下载功能（可选）

### 使用示例

#### 1. 仅获取视频信息（不下载视频）

```bash
node examples/batch-video-details-with-download.js sample-videos.csv
```

#### 2. 获取视频信息并下载视频文件

```bash
node examples/batch-video-details-with-download.js sample-videos.csv --download
```

## CSV文件格式

### 基础格式（仅视频ID）

```csv
video_id
7465492518684183814
7529998477380586766
7530682182436752648
```

### 时长过滤格式（视频ID + 期望时长）

```csv
video_id,duration
7465492518684183814,15
7529998477380586766,30
7530682182436752648,16
```

> **时长过滤说明**：当CSV包含第二列时长数据时，只有实际视频时长在指定时长±1秒范围内的视频才会被标记为CapCut。

## 输出文件

### 1. CSV数据文件

**位置**：`examples/output/batch_videos_YYYY-MM-DDTHH-MM-SS.csv`

**包含字段**：
- 所有原有视频信息字段
- **下载状态**：成功/失败/无可用链接
- **本地文件路径**：下载的视频文件完整路径

### 2. 视频文件

**位置**：`examples/downloads/视频ID.mp4`

**命名规则**：使用视频ID作为文件名

**示例**：
```
examples/downloads/
├── 7465492518684183814.mp4
├── 7529998477380586766.mp4
└── 7530682182436752648.mp4
```

## 下载统计

程序运行结束后会显示详细的下载统计信息：

```
下载统计:
- 尝试下载: 4 个视频
- 下载成功: 3 个视频
- 下载失败: 1 个视频
- 下载目录: /path/to/examples/downloads
```

## 错误处理

### 常见错误及解决方案

1. **网络连接失败**
   - 检查网络连接
   - 稍后重试
   - 考虑使用代理

2. **视频链接无效**
   - 视频可能已被删除或设为私密
   - 检查视频ID是否正确

3. **磁盘空间不足**
   - 清理磁盘空间
   - 检查下载目录权限

4. **API限制**
   - 程序会自动重试
   - 如持续失败，建议稍后重试

## 性能优化建议

### 1. 网络优化
- 使用稳定的网络连接
- 考虑使用代理服务器
- 避免同时运行多个下载任务

### 2. 存储优化
- 确保有足够的磁盘空间
- 定期清理已下载的视频文件
- 使用SSD硬盘提高写入速度

### 3. 系统资源
- 避免在系统负载较高时运行
- 关闭不必要的应用程序
- 监控内存和CPU使用情况

## 注意事项

### 1. 法律合规
- 仅下载公开可访问的视频
- 遵守TikTok平台使用条款
- 不得用于商业用途

### 2. 技术限制
- 部分视频可能因版权保护无法下载
- 下载速度受网络条件影响
- 大文件下载可能需要较长时间

### 3. 存储管理
- 视频文件可能较大，注意磁盘空间
- 建议定期清理不需要的视频文件
- 考虑使用外部存储设备

## 故障排除

### 1. 下载失败
```bash
# 检查网络连接
ping api16-normal-c-useast1a.tiktokv.com

# 检查文件权限
ls -la examples/downloads/

# 重新运行（会自动跳过已下载的文件）
node examples/batch-video-details-with-download.js sample-videos.csv --download
```

### 2. CSV文件问题
```bash
# 检查CSV文件格式
cat sample-videos.csv

# 确保文件编码为UTF-8
file sample-videos.csv
```

### 3. 内存不足
```bash
# 增加Node.js内存限制
node --max-old-space-size=4096 examples/batch-video-details-with-download.js sample-videos.csv --download
```

## 示例完整流程

### 步骤1：准备CSV文件
```bash
# 创建视频ID列表
echo "video_id" > sample-videos.csv
echo "7465492518684183814" >> sample-videos.csv
echo "7529998477380586766" >> sample-videos.csv
```

### 步骤2：运行下载程序
```bash
# 获取信息并下载视频
node examples/batch-video-details-with-download.js sample-videos.csv --download
```

### 步骤3：查看结果
```bash
# 查看CSV数据文件
ls -la examples/output/

# 查看下载的视频文件
ls -la examples/downloads/

# 查看下载统计
tail -n 10 examples/output/batch_videos_*.csv
```

## 更新日志

- **v1.0.0**：初始版本，支持基础下载功能
- **v1.1.0**：增加下载统计和状态跟踪
- **v1.2.0**：支持时长过滤模式
- **v1.3.0**：优化错误处理和重试机制

---

如有问题或建议，欢迎在GitHub提Issue！ 